<div class="bg-white p-6 rounded-lg shadow-sm border">
    <!-- Header -->
    <div class="flex justify-center items-center mb-6">
        <h1 class="text-2xl font-bold uppercase text-gray-700">Quản lý sự kiện</h1>

    </div>

    <!-- Search -->
    <div class="mb-4 flex justify-between items-center">
        <input type="text" placeholder="Tìm kiếm sự kiện..." [(ngModel)]="searchText"
            class="w-1/3 border rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-1 focus:ring-blue-400" />
        <button
            class="flex items-center space-x-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md text-sm"
            (click)="openModal()">
            <lucide-icon name="plus" class="w-4 h-4"></lucide-icon>
            <span>Thêm sự kiện</span>
        </button>
    </div>

    <!-- Table -->
    <div class="overflow-x-auto">
        <table class="w-full text-sm text-left border-collapse table-fixed">
            <colgroup>
                <col class="w-[7%]" />
                <col class="w-[20%]" />
                <col class="w-[35%]" />
                <col class="w-[15%]" />
                <col class="w-[20%]" />
            </colgroup>

            <thead class="bg-gray-100 text-gray-700">
                <tr>
                    <th class="p-3 border text-center">STT</th>
                    <th class="p-3 border text-center">Ảnh</th>
                    <th class="p-3 border text-center">Tên sự kiện</th>
                    <th class="p-3 border text-center">Trạng thái</th>
                    <th class="p-3 border text-center">Thao tác</th>
                </tr>
            </thead>

            <tbody>
                <tr *ngFor="let event of filteredEvents(); let i = index" class="hover:bg-gray-50">
                    <!-- STT -->
                    <td class="p-3 border text-center font-medium">
                        {{ i + 1 }}
                    </td>

                    <!-- Ảnh -->
                    <td class="p-3 border">
                        <img [src]="event.bannerImage" alt="event"
                            class="w-full max-w-[200px] h-auto object-cover rounded-md mx-auto" />
                    </td>

                    <!-- Tên sự kiện -->
                    <td class="p-3 border font-medium">
                        {{ event.name }}
                    </td>

                    <!-- Trạng thái -->
                    <td class="p-3 border text-center">
                        <span [ngClass]="{
                            'text-green-600 font-medium': event.status === 'Đang diễn ra',
                            'text-red-500 font-medium': event.status === 'Đã kết thúc'
                            }">
                            {{ event.status }}
                        </span>
                    </td>

                    <!-- Thao tác -->
                    <td class="p-3 border text-center">
                        <div class="flex items-center justify-center space-x-3">
                            <lucide-icon name="eye" (click)="viewEvent(event)"
                                class="w-5 h-5 text-gray-500 hover:text-blue-600 cursor-pointer"></lucide-icon>
                            <lucide-icon name="edit" (click)="editEvent(event)"
                                class="w-5 h-5 text-gray-500 hover:text-green-600 cursor-pointer"></lucide-icon>
                            <lucide-icon name="trash-2" (click)="deleteEvent(event.eventId)"
                                class="w-5 h-5 text-gray-500 hover:text-red-600 cursor-pointer"></lucide-icon>
                            <lucide-icon name="plus-circle" (click)="addRaceCategory(event)"
                                class="w-5 h-5 text-gray-500 hover:text-purple-600 cursor-pointer" nz-tooltip
                                nzTooltipTitle="Thêm hạng mục chạy"></lucide-icon>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
        <app-pagination [pageNumber]="currentPage" [pageSize]="pageSize" [totalItem]="totalItems"
            (pageChange)="onPageChange($event)"></app-pagination>

    </div>


</div>

<!-- Popup Thêm Sự Kiện -->
<div *ngIf="isModalOpen" class="fixed inset-0 bg-black/40 flex items-center justify-center z-50">
    <div class="bg-white w-[750px] max-h-[90vh] rounded-lg shadow-lg overflow-y-auto p-6 relative">
        <!-- Header -->
        <div class="flex justify-between items-center border-b pb-3 mb-4">
            <h2 class="text-xl font-semibold">
                {{ modalMode === 'view' ? 'Xem chi tiết sự kiện' : modalMode === 'edit' ? 'Chỉnh sửa sự kiện' : 'Thêm sự
                kiện' }}
            </h2>

            <button (click)="closeModal()">
                <lucide-icon name="x" class="w-5 h-5 text-gray-500 hover:text-gray-700"></lucide-icon>
            </button>
        </div>

        <!-- Form -->
        <form (ngSubmit)="onSubmit()" #eventForm="ngForm" enctype="multipart/form-data" class="space-y-4">
            <!-- Name -->
            <div>
                <label class="block text-sm font-medium mb-1">Tên sự kiện <span class="text-red-500">*</span></label>
                <input type="text" name="name" required [(ngModel)]="newEvent.name" [disabled]="modalMode === 'view'"
                    placeholder="VD: Giải chạy Marathon 2025"
                    class="w-full border rounded-md px-3 py-2 text-sm focus:ring-1 focus:ring-blue-400 focus:outline-none" />
            </div>

            <!-- Location -->
            <div>
                <label class="block text-sm font-medium mb-1">Địa điểm <span class="text-red-500">*</span></label>
                <input type="text" name="location" required [(ngModel)]="newEvent.location"
                    [disabled]="modalMode === 'view'" placeholder="VD: Hà Nội, Việt Nam"
                    class="w-full border rounded-md px-3 py-2 text-sm focus:ring-1 focus:ring-blue-400 focus:outline-none" />
            </div>

            <!-- Description -->
            <div>
                <label class="block text-sm font-medium mb-1">Mô tả <span class="text-red-500">*</span></label>
                <textarea name="description" required [(ngModel)]="newEvent.description"
                    placeholder="Nhập mô tả ngắn về sự kiện..." rows="3"
                    class="w-full border rounded-md px-3 py-2 text-sm focus:ring-1 focus:ring-blue-400 focus:outline-none"></textarea>
            </div>

            <!-- Start & End Date -->
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium mb-1">Ngày bắt đầu <span
                            class="text-red-500">*</span></label>
                    <input type="datetime-local" name="startDate" required [(ngModel)]="newEvent.startDate"
                        [disabled]="modalMode === 'view'"
                        class="w-full border rounded-md px-3 py-2 text-sm focus:ring-1 focus:ring-blue-400 focus:outline-none" />
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">Ngày kết thúc <span
                            class="text-red-500">*</span></label>
                    <input type="datetime-local" name="endDate" required [(ngModel)]="newEvent.endDate"
                        [disabled]="modalMode === 'view'"
                        class="w-full border rounded-md px-3 py-2 text-sm focus:ring-1 focus:ring-blue-400 focus:outline-none" />
                </div>
            </div>

            <!-- IsFeatured -->
            <div class="flex items-center space-x-2">
                <input type="checkbox" name="isFeatured" [(ngModel)]="newEvent.isFeatured" class="w-4 h-4"
                    [disabled]="modalMode === 'view'" />
                <label class="text-sm font-medium">Hiển thị nổi bật</label>
            </div>

            <!-- Sections -->
            <div>
                <div class="flex justify-between items-center mb-2">
                    <label class="block text-sm font-medium">Danh sách Sections</label>
                    <button type="button" (click)="openSectionModal()"
                        class="flex items-center bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-xs">
                        <lucide-icon name="plus" class="w-3 h-3 mr-1"></lucide-icon> Thêm Section
                    </button>
                </div>

                <!-- Hiển thị danh sách section -->
                <ul class="border rounded-md divide-y">
                    <li *ngFor="let sec of newEvent.sections; let i = index"
                        class="p-2 flex justify-between items-start">
                        <div>
                            <p class="font-medium text-gray-800">{{ sec.title }}</p>

                        </div>
                        <button (click)="removeSection(i)" type="button"
                            class="text-red-500 hover:text-red-700 text-xs">Xóa</button>
                    </li>
                    <li *ngIf="newEvent.sections.length === 0" class="p-2 text-sm text-gray-500 text-center">
                        Chưa có section nào
                    </li>
                </ul>
            </div>

            <!-- Banner -->
            <div>
                <label class="block text-sm font-medium mb-1">Ảnh bìa sự kiện <span
                        class="text-red-500">*</span></label>
                <input [disabled]="modalMode === 'view'" type="file" (change)="onFileChange($event)"
                    class="w-full border rounded-md px-3 py-2 text-sm" />
            </div>

            <!-- Buttons -->
            <div class="flex justify-end space-x-3 pt-4 border-t mt-4">
                <button type="button" (click)="closeModal()"
                    class="px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-md text-sm">
                    Hủy
                </button>
                <button type="submit" [disabled]="!eventForm.valid"
                    class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md text-sm">
                    Xác nhận
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Popup con: Thêm Section -->
<div *ngIf="isSectionModalOpen" class="fixed inset-0 bg-black/40 flex items-center justify-center z-50">
    <div class="bg-white w-[700px] rounded-lg shadow-lg p-6">
        <div class="flex justify-between items-center border-b pb-3 mb-4">
            <h3 class="text-lg font-semibold">Thêm Section</h3>
            <button (click)="closeSectionModal()">
                <lucide-icon name="x" class="w-5 h-5 text-gray-500 hover:text-gray-700"></lucide-icon>
            </button>
        </div>

        <form (ngSubmit)="addSection()" #sectionForm="ngForm" class="space-y-4">
            <div>
                <label class="block text-sm font-medium mb-1">Tiêu đề Section</label>
                <input [disabled]="modalMode === 'view'" type="text" name="title" required
                    [(ngModel)]="newSection.title" placeholder="VD: Giới thiệu sự kiện"
                    class="w-full border rounded-md px-3 py-2 text-sm focus:ring-1 focus:ring-blue-400 focus:outline-none" />
            </div>
            <div class="min-h-[300px]">
                <label class="block text-sm font-medium mb-1">Nội dung</label>
                <ckeditor [editor]="Editor" [(ngModel)]="newSection.content" name="content" [config]="{
                    toolbar: ['heading', '|', 'bold', 'italic', 'link', 'bulletedList', 'numberedList', '|', 'undo', 'redo']
                    }" class="border rounded-md"></ckeditor>
            </div>

            <div class="flex justify-end space-x-3 pt-3 border-t">
                <button type="button" (click)="closeSectionModal()"
                    class="px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-md text-sm">
                    Hủy
                </button>
                <button type="submit" [disabled]="!sectionForm.valid"
                    class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md text-sm">
                    Thêm
                </button>
            </div>
        </form>
    </div>
</div>