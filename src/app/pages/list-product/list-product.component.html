<section class="container-app my-6 md:my-10 space-y-4 md:space-y-8">
  <!-- üß≠ Breadcrumb - Responsive -->
  <div class="text-xs sm:text-sm text-gray-500 px-2 sm:px-0">
    <a (click)="goHome()" class="hover:text-[#00456F]">Trang ch·ªß</a> /
    <span class="text-gray-700 font-medium">{{ breadcrumbTypeName }}</span>
    <ng-container *ngIf="breadcrumbCategoryName">
      / <span class="text-gray-700 font-medium">{{ breadcrumbCategoryName }}</span>
    </ng-container>
  </div>
  <!-- üß± B·ªô l·ªçc danh m·ª•c - Responsive -->
  <div
    class="flex overflow-x-auto pb-4 sm:pb-0 sm:flex-wrap items-center gap-2 sm:gap-3 justify-start bg-white py-2 px-2 sm:px-0 sm:py-2 scrollbar-thin">
    <button [routerLink]="['/list-product', currentTypeSlug]" (click)="setActiveCategory(defaultCategory)"
      class="flex-shrink-0 w-20 h-20 sm:w-24 sm:h-24 flex flex-col items-center justify-center gap-1 sm:gap-2 rounded-xl border transition-all duration-200 text-center"
      [ngClass]="{
        'border-blue-400 text-[#3AA7E9] font-semibold bg-blue-50':
          selectedCateId === defaultCategory.id,
        'border-gray-300 text-gray-800 hover:border-[#3AA7E9]    hover:text-[#00456F] ':
          selectedCateId !== defaultCategory.id
      }">
      <lucide-icon [name]="defaultCategory.icon" class="w-5 h-5 sm:w-6 sm:h-6"></lucide-icon>
      <span class="text-xs font-semibold uppercase">{{ defaultCategory.name }}</span>
    </button>
    @for (cate of categories; track cate.name) {
    <button (click)="setActiveCategory(cate)" [routerLink]="['/list-product', currentTypeSlug, cate.slug]"
      [queryParams]="{ currentTypeSlug:currentTypeSlug}"
      class="flex-shrink-0 w-20 h-20 sm:w-24 sm:h-24 flex flex-col items-center justify-center gap-1 sm:gap-2 rounded-xl border transition-all duration-200 text-center"
      [ngClass]="{
        'border-blue-400 text-[#3AA7E9] font-semibold bg-blue-50':
          selectedCateId === cate.id,
        'border-gray-300 text-gray-800 hover:border-[#3AA7E9]    hover:text-[#00456F] ':
          selectedCateId !== cate.id
      }">
      <!-- üñºÔ∏è N·∫øu c√≥ icon (v√≠ d·ª•: T·∫•t c·∫£) th√¨ d√πng Lucide -->
      <ng-container *ngIf="cate.icon; else imageIcon">
        <lucide-icon [name]="cate.icon" class="w-5 h-5 sm:w-6 sm:h-6"></lucide-icon>
      </ng-container>

      <!-- üñºÔ∏è N·∫øu kh√¥ng th√¨ hi·ªÉn th·ªã ·∫£nh -->
      <ng-template #imageIcon>
        <img [src]="cate.img || 'assets/boncau.png'" alt="{{ cate.name }}"
          class="w-7 h-7 sm:w-8 sm:h-8 object-contain" />
      </ng-template>

      <span class="text-xs font-semibold uppercase">{{ cate.name }}</span>
    </button>
    }
  </div>

  <!-- üè∑Ô∏è Ti√™u ƒë·ªÅ v√† thanh c√¥ng c·ª• - Responsive -->
  <div class="flex flex-col sm:flex-row sm:items-center justify-between mb-4 gap-3 sm:gap-0 px-2 sm:px-0">
    <!-- üè∑Ô∏è Ti√™u ƒë·ªÅ danh m·ª•c -->
    <h1 class="text-lg sm:text-xl md:text-2xl font-bold text-[#3AA7E9] uppercase">
      {{ activeCategory }}
    </h1>

    <!-- ‚öôÔ∏è Thanh c√¥ng c·ª• - Responsive -->
    <div class="flex flex-wrap items-center gap-2">
      <!-- B·ªè l·ªçc -->
      <button
        class="flex items-center gap-1 border border-gray-300 rounded-md px-2 sm:px-3 py-1.5 text-xs sm:text-sm hover:text-[#3AA7E9] hover:border-[#3AA7E9]  "
        (click)="clearAllFilters()">
        <lucide-icon name="trash2" class="w-3 h-3 sm:w-4 sm:h-4"></lucide-icon>
        <span class="hidden sm:inline">B·ªè l·ªçc</span>
      </button>

      <!-- B√°n ch·∫°y -->
      <button
        class="flex items-center gap-1 border border-gray-300 rounded-md px-2 sm:px-3 py-1.5 text-xs sm:text-sm hover:text-[#3AA7E9] hover:border-[#3AA7E9]  "
        [ngClass]="{ 'text-[#3AA7E9] border-blue-400 bg-blue-50': isFilterActive('banchay') }"
        (click)="toggleFilter('banchay')">
        <lucide-icon name="flame" class="w-3 h-3 sm:w-4 sm:h-4"></lucide-icon>
        <span class="hidden sm:inline">B√°n ch·∫°y</span>
      </button>

      <!-- ƒêang h·∫° gi√° -->
      <button
        class="flex items-center gap-1 border border-gray-300 rounded-md px-2 sm:px-3 py-1.5 text-xs sm:text-sm hover:text-[#3AA7E9] hover:border-[#3AA7E9]  "
        [ngClass]="{ 'text-[#3AA7E9] border-blue-400 bg-blue-50': isFilterActive('discount') }"
        (click)="toggleFilter('discount')">
        <lucide-icon name="percent" class="w-3 h-3 sm:w-4 sm:h-4"></lucide-icon>
        <span class="hidden sm:inline">ƒêang h·∫° gi√°</span>
      </button>

      <!-- M·ªõi nh·∫•t -->
      <button
        class="flex items-center gap-1 border border-gray-300 rounded-md px-2 sm:px-3 py-1.5 text-xs sm:text-sm hover:text-[#3AA7E9] hover:border-[#3AA7E9]  "
        [ngClass]="{ 'text-[#3AA7E9] border-blue-400 bg-blue-50': isFilterActive('new') }"
        (click)="toggleFilter('new')">
        <lucide-icon name="shopping-bag" class="w-3 h-3 sm:w-4 sm:h-4"></lucide-icon>
        <span class="hidden sm:inline">M·ªõi nh·∫•t</span>
      </button>

      <!-- Button Gi√° + dropdown -->
      <div class="relative inline-block">
        <button
          class="flex items-center gap-1 border border-gray-300 rounded-md px-2 sm:px-3 py-1.5 text-xs sm:text-sm hover:text-[#3AA7E9] hover:border-[#3AA7E9]  "
          [ngClass]="{ 'text-[#3AA7E9] border-blue-400 bg-blue-50': isFilterActive('price') }"
          (click)="togglePriceDropdown()">
          <lucide-icon name="dollar-sign" class="w-3 h-3 sm:w-4 sm:h-4"></lucide-icon>
          <span class="hidden sm:inline">Gi√°</span>
          <lucide-icon name="chevron-down" class="w-2 h-2 sm:w-3 sm:h-3"></lucide-icon>
        </button>

        <!-- Dropdown Gi√° -->
        <div *ngIf="showPriceDropdown"
          class="absolute mt-1 right-0 sm:left-0 w-40 sm:w-44 bg-white border border-gray-300 rounded-md shadow-md z-50">
          <!-- T·ª´ cao t·ªõi th·∫•p -->
          <button
            class="flex items-center justify-between w-full text-left px-3 sm:px-4 py-2 hover:bg-blue-50 text-xs sm:text-sm"
            (click)="setSort('pricedesc')">
            <div class="flex items-center gap-1 sm:gap-2">
              <lucide-icon name="chevron-down" class="w-3 h-3 sm:w-4 sm:h-4"></lucide-icon>
              T·ª´ cao t·ªõi th·∫•p
            </div>
          </button>

          <!-- T·ª´ th·∫•p t·ªõi cao -->
          <button
            class="flex items-center justify-between w-full text-left px-3 sm:px-4 py-2 hover:bg-blue-50 text-xs sm:text-sm"
            (click)="setSort('priceasc')">
            <div class="flex items-center gap-1 sm:gap-2">
              <lucide-icon name="chevron-up" class="w-3 h-3 sm:w-4 sm:h-4"></lucide-icon>
              T·ª´ th·∫•p t·ªõi cao
            </div>
          </button>
        </div>
      </div>

      <!-- Ph·ªï bi·∫øn -->
      <button
        class="flex items-center gap-1 border border-gray-300 rounded-md px-2 sm:px-3 py-1.5 text-xs sm:text-sm hover:text-[#3AA7E9] hover:border-[#3AA7E9]  "
        [ngClass]="{ 'text-[#3AA7E9] border-blue-400 bg-blue-50': isFilterActive('popular') }"
        (click)="toggleFilter('popular')">
        <lucide-icon name="trending-up" class="w-3 h-3 sm:w-4 sm:h-4"></lucide-icon>
        <span class="hidden sm:inline">Ph·ªï bi·∫øn</span>
      </button>
    </div>
  </div>

  <!-- üõí Grid s·∫£n ph·∫©m - Responsive -->
  <div
    class="grid grid-cols-2 xs:grid-cols-3 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-3 sm:gap-4 md:gap-5 px-2 sm:px-0">
    @for (p of sortedProducts(); track p.id) {
    <div (click)="goToDetail(p)"
      class="relative bg-white rounded-lg sm:rounded-xl p-2 sm:p-3 md:p-4 border border-gray-200 shadow-sm hover:shadow-md transition-all duration-200 cursor-pointer flex flex-col h-full">
      <!-- Badge -->
      <div *ngIf="p.isHot"
        class="absolute top-1 left-1 sm:top-2 sm:left-2 bg-[#3AA7E9] text-white text-[10px] sm:text-xs px-1.5 sm:px-2 py-0.5 sm:py-1 rounded">
        B√°n ch·∫°y
      </div>

      <!-- Image -->
      <img [src]="p.mainImageUrl" alt="{{ p.name }}" class="w-full h-28 sm:h-32 md:h-40 object-contain mb-2 sm:mb-3" />

      <!-- Content -->
      <div class="flex flex-col flex-1">
        <p class="text-xs sm:text-sm font-bold text-gray-800">{{ p.brand }}</p>

        <!-- T√™n s·∫£n ph·∫©m: clamp + tooltip -->
        <p class="text-[13px] sm:text-[14px] md:text-[15px] text-black mb-1 sm:mb-2 line-clamp-2" [title]="p.name">
          {{ p.name }}
        </p>

        <!-- ƒê·∫©y gi√° xu·ªëng ƒë√°y -->
        <div class="mt-auto">
          <div class="flex items-center gap-1 sm:gap-2">

            <p class="text-gray-400 line-through text-xs">
              {{ p.price| number:'1.0-0':'vi' }}ƒë
            </p>

            <span *ngIf="p.discount ||p.discountPercent" class="bg-red-50 text-red-500 text-[10px]
                       font-semibold px-2 py-[2px] rounded-full">
              -{{ p.discount ||p.discountPercent}}%
            </span>
          </div>
          <p class="text-red-500 font-bold text-sm mt-1">
            {{ p.salePrice | number:'1.0-0':'vi' }}ƒë
          </p>
        </div>
      </div>
    </div>
    }
  </div>

  <!-- üî¢ Ph√¢n trang - Responsive -->
  <div class="flex justify-center items-center mt-4 sm:mt-6 text-sm px-2 sm:px-0">
    <app-pagination class="w-full sm:w-auto" [pageNumber]="pageNumber" [pageSize]="pageSize" [totalItem]="totalItem"
      (pageChange)="pageNumber = $event" (pageSizeChange)="handlePageChange($event)"></app-pagination>
  </div>
</section>